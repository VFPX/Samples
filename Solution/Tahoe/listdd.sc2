*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="listdd.scx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="2" />

	Height = 200
	Left = 251
	Name = "Dataenvironment"
	Top = 242
	Width = 520

ENDDEFINE

DEFINE CLASS frmlistdd AS frmsolution OF "..\solution.vcx" 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Shape1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Shape3" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblTview" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Lst1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Lst2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label5" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Olecontrol1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Olecontrol2" UniqueID="" Timestamp="" />

	*<DefinedPropArrayMethod>
		*a: aitems[1,0]
	*</DefinedPropArrayMethod>

	Caption = "Treeview/Listbox Drag and Drop"
	DoCreate = .T.
	Height = 261
	HelpContextID = 1231621
	Name = "frmListDD"
	Visible = .T.
	Width = 539
	Behindscenes1.Left = 12
	Behindscenes1.Name = "Behindscenes1"
	Behindscenes1.TabIndex = 9
	Behindscenes1.Top = 228
	Behindscenes1.ZOrderSet = 2
	Cmdclose1.Left = 456
	Cmdclose1.Name = "Cmdclose1"
	Cmdclose1.TabIndex = 10
	Cmdclose1.Top = 228
	Cmdclose1.ZOrderSet = 6
	C_solutions1.Left = 48
	C_solutions1.Name = "C_solutions1"
	C_solutions1.Top = 228
	Label1.Caption = "You can use the new OLE Drag and Drop features in VFP6 for moving items between listbox and treeview controls."
	Label1.Height = 27
	Label1.Left = 24
	Label1.Name = "Label1"
	Label1.TabIndex = 2
	Label1.Top = 24
	Label1.Width = 480
	Label1.ZOrderSet = 4
	Label4.Name = "Label4"
	Label4.TabIndex = 1
	Label4.ZOrderSet = 5
	Shape2.Height = 48
	Shape2.Left = 12
	Shape2.Name = "Shape2"
	Shape2.Top = 12
	Shape2.Width = 516
	Shape2.ZOrderSet = 3

	ADD OBJECT 'Label2' AS label WITH ;
		Caption = "Treeview  Drag  ->  Drop", ;
		DragMode = 1, ;
		FontName = "MS Sans Serif", ;
		FontSize = 8, ;
		Height = 15, ;
		Left = 24, ;
		Name = "Label2", ;
		TabIndex = 3, ;
		Top = 65, ;
		Width = 119
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Label5' AS label WITH ;
		Caption = "Listbox  Drag  ->  Drop", ;
		DragMode = 1, ;
		FontName = "MS Sans Serif", ;
		FontSize = 8, ;
		Height = 15, ;
		Left = 288, ;
		Name = "Label5", ;
		TabIndex = 6, ;
		Top = 65, ;
		Width = 108
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'lblTview' AS label WITH ;
		Caption = "", ;
		DragMode = 1, ;
		Height = 17, ;
		Left = 24, ;
		Name = "lblTview", ;
		TabIndex = 11, ;
		Top = 192, ;
		Width = 228
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Lst1' AS listbox WITH ;
		FontName = "MS Sans Serif", ;
		FontSize = 8, ;
		Height = 96, ;
		IntegralHeight = .T., ;
		Left = 288, ;
		MultiSelect = .T., ;
		Name = "Lst1", ;
		OLEDragMode = 1, ;
		OLEDropMode = 1, ;
		RowSource = "One,Two,Three,Four,Five", ;
		RowSourceType = 1, ;
		TabIndex = 7, ;
		Top = 84, ;
		Width = 108
		*< END OBJECT: BaseClass="listbox" />

	ADD OBJECT 'Lst2' AS listbox WITH ;
		FontName = "MS Sans Serif", ;
		FontSize = 8, ;
		Height = 96, ;
		IntegralHeight = .T., ;
		Left = 408, ;
		MultiSelect = .T., ;
		Name = "Lst2", ;
		OLEDragMode = 1, ;
		OLEDropMode = 1, ;
		RowSourceType = 1, ;
		TabIndex = 8, ;
		Top = 84, ;
		Width = 108
		*< END OBJECT: BaseClass="listbox" />

	ADD OBJECT 'Olecontrol1' AS olecontrol WITH ;
		Height = 96, ;
		Left = 24, ;
		Name = "Olecontrol1", ;
		TabIndex = 4, ;
		Top = 84, ;
		Width = 108
		*< END OBJECT: BaseClass="olecontrol" OLEObject="c:\winnt\system32\mscomctl.ocx" Value="0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7////+/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAICpvwPdML0BAwAAAIABAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkgAAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAABcAAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAD4AAAAAAAAABAAAAAIAAAD+/////v///wUAAAD+//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+2kEHHiYXREbFqAMDwKDYoIUM0EggAAAAqCwAA7AkAALE8wWoAAAYAIgAAAJwADgHoAwAACAAKAAEAAAAB782rXAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAACQAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA5MzY4MjY1RS04NUZFLTExZDEtOEJFMy0wMDAwRjg3NTREQTF9AAAATQBpAGMAcgBvAHMAbwBmAHQAIABEAGEAdABlACAAYQABAACADAAAAE9MRURyYWdNb2RlAAkAAABJCgAAAAEAAAAMAAAAT0xFRHJvcE1vZGUACQAAAEkKAAAAAQAAACAAAAAFALTsEgAGKAAAAAAAAAUAAID47BIAAQAAAFwAH97svQEABQAB7RIAA1LjC5GPzhGd4wCqAEu4UQEAAACQAURCAQANTVMgU2FucyBTZXJpZn0AAABNAGkAYwByAG8AcwBvAGYAdAAgAEYAbABhAHQAIABTAGMAcgBvAGwAbABiAGEAcgAgAEMAbwBuAHQAcgBvAGwALAAgAHYAZQByAHMAaQBvAG4AIAA2AC4AMAAJAHsARgBFADMAOAA3ADUAMwBBAC0ANAA0AEEAMwAtADEAMQBEADEALQBCADUAQgA3AC0AMAAwADAAMABDADAAOQAwADAAMABDADQAfQAAAA==" />

	ADD OBJECT 'Olecontrol2' AS olecontrol WITH ;
		Height = 96, ;
		Left = 144, ;
		Name = "Olecontrol2", ;
		TabIndex = 5, ;
		Top = 84, ;
		Width = 108
		*< END OBJECT: BaseClass="olecontrol" OLEObject="c:\winnt\system32\mscomctl.ocx" Value="0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7////+/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAICpvwPdML0BAwAAAIABAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkgAAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAABcAAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAACEAAAAAAAAABAAAAAIAAAD+/////v///wUAAAD+//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+2kEHHiYXREbFqAMDwKDYoIUM0EggAAAAqCwAA7AkAALE8wWoAAAYAIgAAANwADgHoAwAACAAAAAEAAAAB782rXAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAACQAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA5MzY4MjY1RS04NUZFLTExZDEtOEJFMy0wMDAwRjg3NTREQTEAAAAAuA4AAAAAAAA2DwAAAAAAAJ4FAAAAAAAAtAgAAAAAAAABAACADAAAAE9MRURyb3BNb2RlAAkAAABJCgAAAAEAAAALAAAAAAAAUA0AAAAAAAB2AAAAAAAAALwNAAAAAAAAAAAFALTsEgAGIAAAAAAAAAUAAID47BIAAQAAAFwAH97svQEABQAB7RIAA1LjC5GPzhGd4wCqAEu4UQEAAACQAURCAQANTVMgU2FucyBTZXJpZgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==" />

	ADD OBJECT 'Shape1' AS shape WITH ;
		BackStyle = 0, ;
		Height = 144, ;
		Left = 276, ;
		Name = "Shape1", ;
		SpecialEffect = 0, ;
		Top = 72, ;
		Width = 252
		*< END OBJECT: BaseClass="shape" />

	ADD OBJECT 'Shape3' AS shape WITH ;
		BackStyle = 0, ;
		Height = 144, ;
		Left = 12, ;
		Name = "Shape3", ;
		SpecialEffect = 0, ;
		Top = 72, ;
		Width = 252
		*< END OBJECT: BaseClass="shape" />
	
	PROCEDURE Init
		DODEFAULT()
		LOCAL i
		for i= 1 to 5
			this.olecontrol1.nodes.add(,,"LItem"+TRANS(m.i),"LItem"+TRANS(m.i))
			this.olecontrol2.nodes.add(,,"RItem"+TRANS(m.i),"RItem"+TRANS(m.i))
		endfor
		
	ENDPROC

	PROCEDURE Lst1.OLECompleteDrag
		LPARAMETERS nEffect
		LOCAL i,oldExact
		
		*-- If a move operation was performed, remove the moved items 
		*  from the list
		IF nEffect == 2		&&DROPEFFECT_MOVE
			IF EMPTY(THISFORM.aItems)
				RETURN
			ENDIF
			oldExact = SET("EXACT")
			SET EXACT ON
			FOR i = This.ListCount to 1 step -1
				IF ASCAN(THISFORM.aItems,THIS.List[m.i])#0
					This.RemoveItem(m.i)
				ENDIF
			NEXT
			SET EXACT &oldExact
		ENDIF
		
	ENDPROC

	PROCEDURE Lst1.OLEDragDrop
		LPARAMETERS oDataObject, nEffect, nButton, nShift, nXCoord, nYCoord
		LOCAL aValues[1],i 
		
		DIMENSION THISFORM.aItems[1]
		STORE "" TO THISFORM.aItems
		
		#DEFINE	FROM_LOC	" from: "
		
		*-- Remove items from source listbox
		IF oDataObject.GetFormat("VFP Source Object")
			WITH oDataObject.GetData("VFP Source Object")
				IF .Name = THIS.Name	&&don't allow dragdrop on self
					RETURN
				ENDIF
				WAIT WINDOW JUSTEXT(PROGRAM())+FROM_LOC+.Name TIMEOUT .3
			ENDWITH
		ENDIF
		
		*-- If the DataObject has the CF_OLE_VARIANT_ARRAY format then
		*   there is something to process. Add items to listbox 
		IF oDataObject.GetFormat("OLE Variant Array")
			oDataObject.GetData("OLE Variant Array",@aValues)
			*-- For each item in the array
			FOR i = 1 to alen(aValues)
				This.AddItem(aValues[m.i])
			ENDFOR
			ACOPY(aValues,THISFORM.aItems)
		ENDIF
		
		*-- Let the source object know what operation occurred
		IF nShift == 1		&& CTRL key is pressed => copy
			nEffect = 1		&& DROPEFFECT_COPY
		ELSE
			nEffect = 2		&& DROPEFFECT_MOVE
		ENDIF
		
	ENDPROC

	PROCEDURE Lst1.OLEDragOver
		LPARAMETERS oDataObject, nEffect, nButton, nShift, nXCoord, nYCoord, nState
		
		DO CASE
		CASE nState == 0  &&DRAG_ENTER
			*-- IF the data object contains CFSTR_OLEVARIANTARRAY data
			*   then we will communicate that we will accept a drop
			*   of this data by setting the OLEDropHasData property
			*   and specifying which drop effects we support.
			IF oDataObject.GetFormat("OLE Variant Array")
				This.OLEDropHasData = 1		&& DROPHASDATA_USEFUL
				This.OLEDropEffects = 1+2	&& DROPEFFECT_COPY + DROPEFFECT_MOVE
			ENDIF
		CASE nState == 1  &&DRAG_LEAVE
		CASE nState == 2  &&DRAG_OVER
		ENDCASE
	ENDPROC

	PROCEDURE Lst1.OLEStartDrag
		LPARAMETERS oDataObject, nEffect
		LOCAL aValues, i, nSelected
		
		*-- Create an array containing the values of the items that
		*   are currently selected in this listbox
		nSelected = 0
		FOR i = 1 to This.ListCount
		
			*-- If the item is selected, add it to an array
			IF This.Selected( i )
				nSelected = nSelected + 1
		
				DIMENSION aValues[ nSelected ]
				aValues[ nSelected ] = This.List( i )
			ENDIF
		NEXT
		
		*-- The automatic formats that a ListBox has are CF_TEXT, 
		*   CFSTR_OLEVARIANT, and CFSTR_VFPSOURCEOBJECT.  Since we want 
		*   to drag multiple items, we also will need to store the data 
		*   in a CFSTR_OLEVARIANTARRAY format.
		IF nSelected > 0
			oDataObject.SetData(@aValues)
		ENDIF
		
	ENDPROC

	PROCEDURE Lst2.OLECompleteDrag
		LPARAMETERS nEffect
		LOCAL i,oldExact
		
		*-- If a move operation was performed, remove the moved items 
		*  from the list
		IF nEffect == 2		&&DROPEFFECT_MOVE
			IF EMPTY(THISFORM.aItems)
				RETURN
			ENDIF
			oldExact = SET("EXACT")
			SET EXACT ON
			FOR i = This.ListCount to 1 step -1
				IF ASCAN(THISFORM.aItems,THIS.List[m.i])#0
					This.RemoveItem(m.i)
				ENDIF
			NEXT
			SET EXACT &oldExact
		ENDIF
		
	ENDPROC

	PROCEDURE Lst2.OLEDragDrop
		LPARAMETERS oDataObject, nEffect, nButton, nShift, nXCoord, nYCoord
		LOCAL aValues[1],i 
		
		DIMENSION THISFORM.aItems[1]
		STORE "" TO THISFORM.aItems
		
		#DEFINE	FROM_LOC	" from: "
		
		*-- Remove items from source listbox
		IF oDataObject.GetFormat("VFP Source Object")
			WITH oDataObject.GetData("VFP Source Object")
				IF .Name = THIS.Name	&&don't allow dragdrop on self
					RETURN
				ENDIF
				WAIT WINDOW JUSTEXT(PROGRAM())+FROM_LOC+.Name TIMEOUT .3
			ENDWITH
		ENDIF
		
		*-- If the DataObject has the CF_OLE_VARIANT_ARRAY format then
		*   there is something to process. Add items to listbox 
		IF oDataObject.GetFormat("OLE Variant Array")
			oDataObject.GetData("OLE Variant Array",@aValues)
			*-- For each item in the array
			FOR i = 1 to alen(aValues)
				This.AddItem(aValues[m.i])
			ENDFOR
			ACOPY(aValues,THISFORM.aItems)
		ENDIF
		
		*-- Let the source object know what operation occurred
		IF nShift == 1		&& CTRL key is pressed => copy
			nEffect = 1		&& DROPEFFECT_COPY
		ELSE
			nEffect = 2		&& DROPEFFECT_MOVE
		ENDIF
		
	ENDPROC

	PROCEDURE Lst2.OLEDragOver
		LPARAMETERS oDataObject, nEffect, nButton, nShift, nXCoord, nYCoord, nState
		
		DO CASE
		CASE nState == 0  &&DRAG_ENTER
			*-- IF the data object contains CFSTR_OLEVARIANTARRAY data
			*   then we will communicate that we will accept a drop
			*   of this data by setting the OLEDropHasData property
			*   and specifying which drop effects we support.
			IF oDataObject.GetFormat("OLE Variant Array")
				This.OLEDropHasData = 1		&& DROPHASDATA_USEFUL
				This.OLEDropEffects = 1+2	&& DROPEFFECT_COPY + DROPEFFECT_MOVE
			ENDIF
		CASE nState == 1  &&DRAG_LEAVE
		CASE nState == 2  &&DRAG_OVER
		ENDCASE
		
	ENDPROC

	PROCEDURE Lst2.OLESetData
		LPARAMETERS oDataObject, xFormat
	ENDPROC

	PROCEDURE Lst2.OLEStartDrag
		LPARAMETERS oDataObject, nEffect
		LOCAL aValues, i, nSelected
		
		*-- Create an array containing the values of the items that
		*   are currently selected in this listbox
		nSelected = 0
		FOR i = 1 to This.ListCount
		
			*-- If the item is selected, add it to an array
			IF This.Selected( i )
				nSelected = nSelected + 1
		
				DIMENSION aValues[ nSelected ]
				aValues[ nSelected ] = This.List( i )
			ENDIF
		NEXT
		
		*-- The automatic formats that a ListBox has are CF_TEXT, 
		*   CFSTR_OLEVARIANT, and CFSTR_VFPSOURCEOBJECT.  Since we want 
		*   to drag multiple items, we also will need to store the data 
		*   in a CFSTR_OLEVARIANTARRAY format.
		IF nSelected > 0
			oDataObject.SetData(@aValues)
		ENDIF
		
	ENDPROC

	PROCEDURE Olecontrol2.NodeClick
		*** OLE Control Event ***
		LPARAMETERS node
		IF TYPE("this.DropHighlight.enabled")#"L"
			THIS.DropHighlight = node
		ENDIF
		
	ENDPROC

	PROCEDURE Olecontrol2.OLEDragDrop
		*** OLE Control Event ***
		LPARAMETERS data, effect, button, shift, x, y
		LOCAL oNode
		oNode=this.Hittest(x/96*1440,y/96*1440)
		
		IF TYPE("oNode")="O" AND !ISNULL(oNode)
			this.DropHighlight = oNode
			THISFORM.lblTview.Forecolor = RGB(255,0,0)
			THISFORM.lblTview.Caption = JUSTEXT(PROGRAM())+": "+this.DropHighlight.text
		ENDIF
		
	ENDPROC

	PROCEDURE Olecontrol2.OLEDragOver
		*** OLE Control Event ***
		LPARAMETERS data, effect, button, shift, x, y, state
		LOCAL oNode
		oNode=this.Hittest(x/96*1440,y/96*1440)
		IF TYPE("oNode")="O" AND !ISNULL(oNode)
			this.DropHighlight = oNode
			IF TYPE("this.DropHighlight.text")="C"
				THISFORM.lblTview.Forecolor = RGB(0,0,0)
				THISFORM.lblTview.Caption = JUSTEXT(PROGRAM())+": "+this.DropHighlight.text
			ENDIF
		ENDIF
		
	ENDPROC

ENDDEFINE
