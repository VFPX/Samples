*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="windowsevents.scx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="2" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Cursor1" UniqueID="" Timestamp="" />

	DataSource = .NULL.
	Height = 200
	Left = 102
	Name = "Dataenvironment"
	Top = 446
	Width = 520

	ADD OBJECT 'Cursor1' AS cursor WITH ;
		Alias = "winevents", ;
		CursorSource = winevents.dbf, ;
		Height = 90, ;
		Left = 10, ;
		Name = "Cursor1", ;
		Top = 20, ;
		Width = 91
		*< END OBJECT: BaseClass="cursor" />

ENDDEFINE

DEFINE CLASS frmsolution1 AS frmsolution OF "..\solution.vcx" 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Shape3" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="cboTitle" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="cmdSource" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="chkEvents" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="cntEvent" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="cmdConstants" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Olecontrol1" UniqueID="" Timestamp="" />

	*<DefinedPropArrayMethod>
		*m: defaultscript
		*m: handlewinmsg
		*m: releaseevent
		*m: vfprefresh
		*p: nstartwidth
		*p: oevent
		*p: _memberdata		&& XML Metadata for customizable properties
	*</DefinedPropArrayMethod>

	Caption = "Binding to Windows Message Events"
	DoCreate = .T.
	Height = 354
	MinWidth = 200
	Name = "Frmsolution1"
	oevent = .F.
	ShowTips = .F.
	Width = 661
	_memberdata = <VFPData>

		</VFPData>		&& XML Metadata for customizable properties
	Behindscenes1.Anchor = 6
	Behindscenes1.Left = 12
	Behindscenes1.Name = "Behindscenes1"
	Behindscenes1.TabIndex = 9
	Behindscenes1.Top = 324
	Behindscenes1.ZOrderSet = 2
	Cmdclose1.Anchor = 12
	Cmdclose1.Height = 23
	Cmdclose1.Left = 576
	Cmdclose1.Name = "Cmdclose1"
	Cmdclose1.TabIndex = 10
	Cmdclose1.Top = 324
	Cmdclose1.Width = 72
	Cmdclose1.ZOrderSet = 4
	C_solutions1.fixedformborder = .F.
	C_solutions1.Left = 48
	C_solutions1.Name = "C_solutions1"
	C_solutions1.Top = 324
	label1.Anchor = 10
	label1.Caption = "The BINDEVENT() function can be used to trap for Windows Message events. Select an event from the dropdown and click on the Enable Event button to bind. Click on the View Source button to see the class used to handle the selected event."
	label1.Height = 56
	label1.Left = 18
	label1.Name = "label1"
	label1.TabIndex = 2
	label1.Top = 23
	label1.Width = 300
	label1.ZOrderSet = 5
	Label4.Name = "Label4"
	Label4.TabIndex = 1
	Label4.ZOrderSet = 7
	Shape2.Anchor = 10
	Shape2.Height = 72
	Shape2.Left = 12
	Shape2.Name = "Shape2"
	Shape2.Top = 12
	Shape2.Width = 312
	Shape2.ZOrderSet = 3

	ADD OBJECT 'cboTitle' AS combobox WITH ;
		Anchor = 10, ;
		BoundTo = .T., ;
		FontBold = .F., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		Height = 24, ;
		Left = 12, ;
		Name = "cboTitle", ;
		RowSource = "winevents.title", ;
		RowSourceType = 6, ;
		Style = 2, ;
		TabIndex = 3, ;
		Top = 92, ;
		Width = 312, ;
		ZOrderSet = 6
		*< END OBJECT: BaseClass="combobox" />

	ADD OBJECT 'chkEvents' AS checkbox WITH ;
		Alignment = 0, ;
		Anchor = 9, ;
		AutoSize = .T., ;
		Caption = "Enable Event", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		Height = 25, ;
		Left = 348, ;
		Name = "chkEvents", ;
		Style = 1, ;
		TabIndex = 4, ;
		Top = 24, ;
		Value = .F., ;
		Width = 101, ;
		ZOrderSet = 10
		*< END OBJECT: BaseClass="checkbox" />

	ADD OBJECT 'cmdConstants' AS commandbutton WITH ;
		Anchor = 9, ;
		Caption = "Constants", ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		Height = 23, ;
		Left = 552, ;
		Name = "cmdConstants", ;
		TabIndex = 6, ;
		Top = 24, ;
		Width = 84
		*< END OBJECT: BaseClass="commandbutton" />

	ADD OBJECT 'cmdSource' AS commandbutton WITH ;
		Anchor = 9, ;
		Caption = "View Source", ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		Height = 23, ;
		Left = 456, ;
		Name = "cmdSource", ;
		TabIndex = 5, ;
		Top = 24, ;
		Width = 84
		*< END OBJECT: BaseClass="commandbutton" />

	ADD OBJECT 'cntEvent' AS container WITH ;
		Anchor = 13, ;
		Height = 240, ;
		Left = 336, ;
		Name = "cntEvent", ;
		Style = 3, ;
		TabIndex = 7, ;
		Top = 72, ;
		Width = 312
		*< END OBJECT: BaseClass="container" />

	ADD OBJECT 'Olecontrol1' AS olecontrol WITH ;
		Anchor = 15, ;
		Height = 192, ;
		Left = 12, ;
		Name = "Olecontrol1", ;
		TabIndex = 8, ;
		Top = 120, ;
		Width = 312
		*< END OBJECT: BaseClass="olecontrol" OLEObject="c:\winnt\system32\shdocvw.dll" Value="0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7////+/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIB+rkj1wcQBAwAAAEABAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArAAAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAA4AAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAQAAAAAAAAAAwAAAP7////+////BAAAAP7///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9h+VaICjTQEalrAMBP1wWiTAAAAD8gAADYEwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAOAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAABzAGUAdAB0AAEAAIBnAAAAqwAOAAAQuTQuAO0AAAEIAOj6WCfEWh0AEFsdAAD7WCcAAAAAAQAAAAAAAAAwDFknIAxZJwAMWScBAAAA4NBXAHM1zxGuaQgAKy4SYggAAAAAAAAATAAAAAEUAgAAAAAAwAAAAAAAAEaAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAABUWx0AoFsdAAD7WCcBAAAAHgAAAAAAHQAwDFknIAxZJwAMWScAAAAAAAAAAAAAAADmXfUAAAAdAOZd9QAAAAAACgAAAAAAAAAAAAAA4EQeAAAAAADIJVsnuCVbJwAADgAAAQwAAAAAAAAAAAD/////AAAAAAAAAAAEAAAA6PpYJ9RbHQAQXB0AAPtYJwEAAAAfAAAAAABlAGj9WCdI/VgnAAAAAAAAAAAAAAAAAAAAAAAAAAAQWx0AAAAAAAEAAAD/////mCdbJxAnWye4Wh0AAAxZJw==" />

	ADD OBJECT 'Shape3' AS shape WITH ;
		Anchor = 8, ;
		Height = 48, ;
		Left = 336, ;
		Name = "Shape3", ;
		SpecialEffect = 0, ;
		Style = 3, ;
		Top = 12, ;
		Width = 313, ;
		ZOrderSet = 0
		*< END OBJECT: BaseClass="shape" />
	
	PROCEDURE defaultscript
		LOCAL loError
		
		TRY
			THIS.cntEvent.AddObject("edtEvent","Editbox")
			WITH THIS.cntEvent.edtEvent
				.Top = 2
				.Left = 2
				.Height = THIS.cntEvent.Height - 4
				.Width = THIS.cntEvent.Width - 4
				.Anchor = THIS.cntEvent.Anchor
				.Visible = .T.
			ENDWITH
		
		CATCH TO loError
			MESSAGEBOX(loError.Message)
			
		ENDTRY
	ENDPROC

	PROCEDURE handlewinmsg
		LPARAMETERS eValue, eAction
		
		#DEFINE CRLF 	CHR(13)+CHR(10)
		
		DO CASE
		
		CASE TYPE("THIS.cntEvent.Objects[1]")="O"
		
			loObject = THIS.cntEvent.Objects[1]
		
			DO CASE
			CASE UPPER(loObject.BaseClass)="EDITBOX"
				loObject.Value = loObject.Value + TRANSFORM(eValue) + CRLF
				
			CASE UPPER(loObject.BaseClass)="LISTBOX"
		
			OTHERWISE
		
			ENDCASE
		
			OTHERWISE
		
		ENDCASE
	ENDPROC

	PROCEDURE Refresh
		ACTIVATE SCREEN
		DO WHILE NOT VARTYPE(THIS.olecontrol1.OBJECT.Document) = "O"
		ENDDO
		
		WITH THIS.olecontrol1.OBJECT.Document
			.Open()
			.Write(ALLTRIM(Desc))
			.Close()
		ENDWITH
		
	ENDPROC

	PROCEDURE Release
		THISFORM.ReleaseEvent()
		DODEFAULT()
	ENDPROC

	PROCEDURE releaseevent
		LOCAL lnCount,i
		THIS.oEvent = NULL
		
		lnCount = THIS.cntEvent.ControlCount 
		FOR i = lnCount TO 1 STEP -1
			THIS.cntEvent.RemoveObject(THIS.cntEvent.Controls[m.i].Name)
		ENDFOR
	ENDPROC

	PROCEDURE vfprefresh
		_SCREEN.Refresh()
	ENDPROC

	PROCEDURE cboTitle.Init
		THIS.ListIndex=1
	ENDPROC

	PROCEDURE cboTitle.InteractiveChange
		THISFORM.ReleaseEvent()
		WITH THISFORM.chkEvents
			.Value = .F.
			.Caption = "Enable Event"
			.ForeColor = RGB(0,0,0)
		ENDWITH
		THISFORM.cmdSource.Enabled = .T.
		THISFORM.Refresh
		
	ENDPROC

	PROCEDURE chkEvents.Click
		* Run scripts
		LOCAL lcEventlib,lcClass,lcScript,loError
		
		IF THIS.Value=.F.
			THISFORM.ReleaseEvent()
		ELSE
			SELECT Winevents
			lcScript = ALLTRIM(THISFORM.cboTitle.DisplayValue)
			LOCATE FOR Title = lcScript 
			IF !FOUND()
				RETURN
			ENDIF
		
			lcEventlib = ADDBS(JUSTPATH(SYS(1271, THISFORM))) + "wmhandler.vcx"
			lcClass = ALLTRIM(Class)
			TRY
				IF !EMPTY(ALLTRIM(Script))
					EXECSCRIPT(Script,THISFORM)
				ELSE
					THISFORM.DefaultScript()
				ENDIF
				THISFORM.oEvent=NEWOBJECT(lcClass,lcEventlib)
				THISFORM.oEvent.oHandler = THISFORM
				THISFORM.oEvent.LoadEvent()
		
			CATCH TO loError
				THIS.Value=.F.
				THISFORM.ReleaseEvent()
				MESSAGEBOX(loError.Message)
			ENDTRY
		ENDIF
		
		THIS.Caption = IIF(THIS.Value,"Disable Event","Enable Event")
		THIS.ForeColor = IIF(THIS.Value,RGB(255,0,0),RGB(0,0,0))
		THISFORM.cmdSource.Enabled = !THIS.Value
	ENDPROC

	PROCEDURE cmdConstants.Click
		TRY
			MODIFY FILE (ADDBS(JUSTPATH(SYS(1271, THISFORM))) + "wmhandler.h") NOWAIT
		CATCH TO loError
			MESSAGEBOX(loError.Message)
		ENDTRY
	ENDPROC

	PROCEDURE cmdSource.Click
		LOCAL lcEventlib,lcClass,lcScript,loError
		SELECT Winevents
		lcScript = ALLTRIM(THISFORM.cboTitle.DisplayValue)
		LOCATE FOR Title = lcScript 
		IF !FOUND()
			RETURN
		ENDIF
		lcEventlib = ADDBS(JUSTPATH(SYS(1271, THISFORM))) + "wmhandler.vcx"
		lcClass = ALLTRIM(Class)
		TRY
			MODIFY CLASS (lcClass) OF (lcEventlib) NOWAIT
		CATCH TO loError
			MESSAGEBOX(loError.Message)
		ENDTRY
	ENDPROC

	PROCEDURE Olecontrol1.BeforeNavigate2
		*** ActiveX Control Event ***
		LPARAMETERS pdisp, url, flags, targetframename, postdata, headers, cancel
		
		RETURN
		
		IF url = "vfps://"
			Cancel = .T.
			LOCAL lcMode
			url = SUBSTR(url,8)
			lcMode = LOWER(LEFT(url,AT("\",url)-1))
			DO CASE
				CASE lcMode = "key"
				CASE lcMode = "name"
				CASE lcMode = "register"
				OTHERWISE
				?? Chr(7)
			ENDCASE
		ENDIF
		
		IF url="file:" OR SUBSTR(url,2,2)=":\"
			Cancel = .T.
			DECLARE INTEGER ShellExecute ;
				IN SHELL32.DLL ;
				INTEGER nWinHandle,;
				STRING cOperation,;   
				STRING cFileName,;
				STRING cParameters,;
				STRING cDirectory,;
				INTEGER nShowWindow
			ShellExecute(0,"Open",URL,"","",1)
		ENDIF
	ENDPROC

	PROCEDURE Olecontrol1.Init
		THIS.Navigate("about:blank")
	ENDPROC

	PROCEDURE Olecontrol1.Refresh
		*** ActiveX Control Method ***
		NODEFAULT
	ENDPROC

ENDDEFINE
